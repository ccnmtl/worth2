{% extends 'pagetree/base_pagetree.html' %}
{% load render %}
{% load user_status %}

{% block js %}
{% for block in section.pageblock_set.all %}
{% renderjs block %}
{% endfor %}
{% endblock %}

{% block css %}
{% for block in section.pageblock_set.all %}
{% rendercss block %}
{% endfor %}
{% endblock %}

{% block bodyclass %}module-{{module.slug}}{% endblock %}

{% block bodyid %}section-{{section.id}}{% endblock %}

{% block title %}{{section.label}}{% endblock %}

{% block pagetitle %}<h1>{{section.label}}</h1>{% endblock %}

{% block moduletabs %}

<ul class="nav navbar-nav">
  {% for section in modules %}
  <li{% ifequal section.id module.id %} class="active"{% endifequal %}><a href="{{section.get_absolute_url}}">{{section.label}}</a></li>
  {% endfor %}
</ul>

{% endblock %}

{% block navrightextra %}
{% if not request.user.is_anonymous %}
<li><a href="{{section.get_edit_url}}" class="btn btn-success">edit page</a></li>
{% endif %}
{% endblock %}

{% block sidenav %}
{% endblock %}

{% block content %}

<script>
    var isSectionUnlocked = {% is_section_unlocked section user %};
</script>

<div id="content">
{% if needs_submit and not is_submitted %}
<form action="." method="post">{% csrf_token %}
{% endif %}

{% for block in section.pageblock_set.all %}
<div class="pageblock{% if block.css_extra %} {{block.css_extra}}{% endif %}">
{% if block.label %}<h3>{{block.label}}</h3>{% endif %}
{% render block %}
</div>
{% endfor %}

{% if needs_submit and not request.user.is_anonymous %}

<div class="clearfix"></div>
<div class="alert alert-danger worth-form-validation-error"
     role="alert"
     {% if not is_submission_empty %}
     style="display: none;"
     {% endif %}
     >
    <h4>Oops!</h4>
    <p>Please fill out all required questions.</p>
</div>

{% if is_submitted %}
{% if allow_redo or user.is_superuser %}
<div class="clearfix"></div>
<form class="pagetree-form-submit-area"
      action="." method="post">{% csrf_token %}
    <input type="hidden" name="action" value="reset" />
    <input type="submit" value="change my answers" class="btn" />
</form>
{% endif %}
{% else %}

<div class="clearfix"></div>

{% comment %}
The avatar selector block needs to hide the submit button, since
each avatar has its own submit button.
{% endcomment %}
{% if not avatarselectorblock %}
<div class="pagetree-form-submit-area">
    <input type="submit" value="Submit" class="btn btn-primary" />
</div>
{% endif %}

</form>
{% endif %}
{% endif %}

{% include "pagetree/toc.html" %}

</div>
{% endblock %}

{% block content-nav %}
{% with previous=section.get_previous next_section=section.get_next %}
<ul class="pager">
{% if previous %}
  <li class="previous">
        <a href="{{previous.get_absolute_url}}">&larr; {{previous.label}}</a>
  </li>
{% endif %}

{% if next_section %}

{% comment %}
  The "next" link gets rendered as disabled by default. app.js
  immediately enables this link if there's no video player on the page.

  Otherwise, this link is enabled when the video finishes playing.
{% endcomment %}
<li class="next disabled">
    <a href="{{next_section.get_absolute_url}}"
       >{{next_section.label}} &rarr;</a>
</li>
{% endif %}
</ul>
{% endwith %}
{% endblock %}
